# ROS机器人学习

### 1. 机器人总体控制结构

![](https://p.ipic.vip/tmp0qj.png)
![](https://p.ipic.vip/n6920d.png)
* 硬件：
    * stm32处理电机、舵机、蜂鸣器、IMU、电池电量、RGB彩灯、EEPROM等执行器件或者传感器
    * 树莓派接摄像头、激光雷达等硬件、通过串口（单独的通信协议）和stm32连接
![](https://p.ipic.vip/dnbi92.png)
* 软件：
    * freeRTOS（stm32） ，实时的嵌入式系统
    * ROS（树莓派linux），分布式的机器人系统
    * 都是模块化的编程，单个功能单个节点可以调试测试

### 2. 关键技术点

* 编码器+PID控制
    * 编码器可以检测电机实际速度，通过PID控制算法调节PWM输出，实现速度的准确控制
* 运动学正逆解
    * 前向运动学，通过机器人各轮速度求解出机器人XYZ三个轴的方向的矢量速度
    * 逆向运动学，通过机器人各轴的矢量速度求解出各轮速度，实现机器人运动学的逆解
* ROS工具
    * TF坐标变换
    * RViz可视化工具
    * Qt工具箱，rqt_graph，rqt_plot，rqt_bag等

### 3. 使用工具

* stm32
    * 编程用C语言
    * 编程工具用MDK5，串口烧录可以用flymcu（ISP模式）
    * 调试可以用串口调试助手
* 树莓派ROS
    * 编程用Python（也可以C++）
    * 工具用vscode远程连接树莓派

### 4.FOC控制
Force-based Operational Control，无刷电机的控制方法，通过电机的力矩控制电机转速，电机的像素级控制，可以做到效率最好，噪音最小。

* 硬件：
    * 主控芯片，STM32F103C8T6
    * 电机驱动，DRV8313，MOS开关电机驱动，可以三路PWM控制电机转速
    * 电流检测，INA219，可以检测电机电流，力矩反馈
    * 角度检测，磁编码器MT6816CT-ACD，检测电机转角（径向磁铁安装在电机轴上）
* 软件
    * dq坐标变换，检测ABC三相电流（力矩）+ 检测的电机转角，转为dp坐标（目标d为0）
    * SVPWM算法，已知目标dq和角度，反向计算三相电压和PWM占空比，输出到电机驱动
